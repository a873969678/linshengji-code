(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1459"],{"++iw":function(e,t,a){"use strict";var r=a("3bfH");a.n(r).a},"11AD":function(e,t,a){},"3bfH":function(e,t,a){},"4MVG":function(e,t,a){},Fasf:function(e,t,a){},"JD/F":function(e,t,a){},LKpn:function(e,t,a){"use strict";var r=a("LZ+k");a.n(r).a},"LZ+k":function(e,t,a){},Lv1Y:function(e,t,a){"use strict";var r=a("Fasf");a.n(r).a},O53Z:function(e,t,a){"use strict";var r=a("11AD");a.n(r).a},U0Bm:function(e,t,a){var r,i=a("2EsI"),n=i.util,o=i.graphic,s=i.matrix;function l(e,t){this._bmap=e,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=t,this._projection=new BMap.MercatorProjection}function c(e,t){return t=t||[0,0],n.map([0,1],function(a){var r=t[a],i=e[a]/2,n=[],o=[];return n[a]=r-i,o[a]=r+i,n[1-a]=o[1-a]=t[1-a],Math.abs(this.dataToPoint(n)[a]-this.dataToPoint(o)[a])},this)}l.prototype.dimensions=["lng","lat"],l.prototype.setZoom=function(e){this._zoom=e},l.prototype.setCenter=function(e){this._center=this._projection.lngLatToPoint(new BMap.Point(e[0],e[1]))},l.prototype.setMapOffset=function(e){this._mapOffset=e},l.prototype.getBMap=function(){return this._bmap},l.prototype.dataToPoint=function(e){var t=new BMap.Point(e[0],e[1]),a=this._bmap.pointToOverlayPixel(t),r=this._mapOffset;return[a.x-r[0],a.y-r[1]]},l.prototype.pointToData=function(e){var t=this._mapOffset;return[(e=this._bmap.overlayPixelToPoint({x:e[0]+t[0],y:e[1]+t[1]})).lng,e.lat]},l.prototype.getViewRect=function(){var e=this._api;return new o.BoundingRect(0,0,e.getWidth(),e.getHeight())},l.prototype.getRoamTransform=function(){return s.create()},l.prototype.prepareCustoms=function(e){var t=this.getViewRect();return{coordSys:{type:"bmap",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:n.bind(this.dataToPoint,this),size:n.bind(c,this)}}},l.dimensions=l.prototype.dimensions,l.create=function(e,t){var a,i=t.getDom();e.eachComponent("bmap",function(e){var n=t.getZr().painter,o=n.getViewportRoot();if("undefined"==typeof BMap)throw new Error("BMap api is not loaded");if(r=r||function(){function e(e){this._root=e}return e.prototype=new BMap.Overlay,e.prototype.initialize=function(e){return e.getPanes().labelPane.appendChild(this._root),this._root},e.prototype.draw=function(){},e}(),a)throw new Error("Only one bmap component can exist");if(!e.__bmap){var s=i.querySelector(".ec-extension-bmap");s&&(o.style.left="0px",o.style.top="0px",i.removeChild(s)),(s=document.createElement("div")).style.cssText="width:100%;height:100%",s.classList.add("ec-extension-bmap"),i.appendChild(s);var c=e.__bmap=new BMap.Map(s),p=new r(o);c.addOverlay(p),n.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}c=e.__bmap;var u=e.get("center"),m=e.get("zoom");if(u&&m){var d=new BMap.Point(u[0],u[1]);c.centerAndZoom(d,m)}(a=new l(c,t)).setMapOffset(e.__mapOffset||[0,0]),a.setZoom(m),a.setCenter(u),e.coordinateSystem=a}),e.eachSeries(function(e){"bmap"===e.get("coordinateSystem")&&(e.coordinateSystem=a)})};var p=l;e.exports=p},YGUQ:function(e,t,a){var r=a("2EsI").extendComponentModel({type:"bmap",getBMap:function(){return this.__bmap},setCenterAndZoom:function(e,t){this.option.center=e,this.option.zoom=t},centerOrZoomChanged:function(e,t){var a=this.option;return!(function(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]}(e,a.center)&&t===a.zoom)},defaultOption:{center:[104.114129,37.550339],zoom:5,mapStyle:{},mapStyleV2:{},roam:!1}});e.exports=r},ZaiN:function(e,t,a){"use strict";var r=a("JD/F");a.n(r).a},"ca/E":function(e,t,a){"use strict";var r=a("wAwI");a.n(r).a},dOn1:function(e,t,a){"use strict";var r=a("4MVG");a.n(r).a},hVY1:function(e,t,a){"use strict";var r=a("pDiO");a.n(r).a},pDiO:function(e,t,a){},"stv/":function(e,t,a){"use strict";a.r(t);var r=a("/umX"),i=a.n(r),n=a("6ZY3"),o=a.n(n),s=a("omC7"),l=a.n(s),c=a("HB48"),p=a("4E9k"),u=a.n(p);function m(e,t){var a=u.a.get("bashUrl")+"dmp-api",r=t?"/marvel/GetMatrix":"/marvel/GetDeployedMatrix";return Object(c.a)({url:a+r,method:"POST",data:e})}a("Vr5V");function d(e){var t=u.a.get("bashUrl")+"dmp-api";return Object(c.a)({url:t+"/marvel/VerifyExportReq",method:"POST",data:e})}function h(e,t,a){var r=(a?new Date(a):new Date).getTime(),i=new Date(r-24*e*3600*1e3),n=i.getFullYear(),o=i.getMonth()+1,s=i.getDate();return s<10&&(s="0"+s),o<10&&(o="0"+o),1===t?o+"."+s:3===t?n+"-"+o+"-"+s:n+"/"+o+"/"+s}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments[1],a=arguments[2],r=[],i="";if(a){var n=3;new Date(a).getDate()<5&&(n=0),i=new Date(a-864e5*n)}else i=new Date;var o=i.getMonth()+e;if(o<0){var s=parseInt(-o/12);o+=12*s,i.setFullYear(i.getFullYear()-s)}var l=(i=new Date(i.setMonth(o))).getMonth(),c=i.getFullYear(),p=new Date(c,l,1),u=new Date(c,l+1,0);return r.push(g(p,t)),r.push(g(u,t)),r}function g(e,t){var a=e,r=a.getFullYear(),i=a.getMonth()+1<10?"0"+parseInt(a.getMonth()+1):a.getMonth()+1,n=a.getDate()<10?"0"+a.getDate():a.getDate();return 1===t?i+"."+n:2===t?r+"/"+i:3===t?r+"-"+i+"-"+n:r+"/"+i+"/"+n}var v=a("Asgo"),y=a.n(v);var b=a("2EsI"),x=a.n(b),D={name:"LineMatrix",props:{data:{type:Array,default:function(){return[]}}},watch:{data:{handler:function(e,t){e[1].length>0&&this.myChartLine()},deep:!0}},created:function(){},mounted:function(){this.data[1].length>0&&this.myChartLine()},methods:{splcieName:function(e){if(e&&1!==e.length){var t=Number(e.substr(e.length-1));if(isNaN(t))return e;var a=e.substr(0,e.length-1);return this.splcieName(a)}return e},toFixed:function(e){return isNaN(e/1)?e:(e%1!=0&&(e=(e=Number(e)).toFixed(2)),Number(e)===parseInt(e)&&e.toString().indexOf(".")>0?parseInt(e):e)},myChartLine:function(){var e=this;if(this.data[0].length<2)return!1;if(!this.data[3].matrixTableSource)return!1;var t=x.a.init(document.getElementById("echarsLine")),a=this.data[3].matrixTableSource.dictionary.additionalInfoMap.reportConfig||"",r="",i="";a?(i=a.line.x,r=a.line.y):(i=this.data[0][0].key,r=[this.data[0][1].key]);var n=[],o=this.data[0].filter(function(e){return e.name===i||e.key===i});this.data[1].forEach(function(e){n.push(e[o[0].key])});var s=[],l=[];this.data[0].forEach(function(e){r.indexOf(e.name)>-1?l.push(e):r.indexOf(e.key)>-1&&l.push(e)}),r.forEach(function(t,a){r[a]=e.splcieName(t)});var c=["#028090","#FCBF49","#02C39A","#FFE16D","#80E6B3","#F77F00","#F0F3BD","#D62828","#05668D","#003049"];l.forEach(function(t,r){var i={name:e.splcieName(t.name),type:"line",data:[]};c[r]&&(i.itemStyle={normal:{color:c[r],lineStyle:{color:c[r]}}}),e.data[1].forEach(function(a){i.data.push(e.toFixed(a[t.key]))}),a&&a.line.sort&&i.data.reverse(),s.push(i)}),a&&a.line.sort&&n.reverse();var p={title:{text:this.data[2]},tooltip:{trigger:"axis"},legend:{top:"10%",data:r},grid:{left:"3%",right:"4%",bottom:"3%",top:"25%",containLabel:!0},toolbox:{right:"4%",feature:{saveAsImage:{},magicType:{type:["line","bar"]}}},xAxis:{type:"category",boundaryGap:!1,data:n},yAxis:{type:"value"},series:s};t.setOption(p),setTimeout(function(){t.resize()},50)}}},w=(a("dOn1"),a("ZrdR")),M=Object(w.a)(D,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"lineMatrix",attrs:{id:"lineMatrix"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:this.data[1].length>0,expression:"data[1].length > 0"}],style:{width:"100%",height:"500px"},attrs:{id:"echarsLine"}})])},[],!1,null,"0b668634",null);M.options.__file="line.vue";var P=M.exports,q={name:"PieMatrix",props:{data:{type:Array,default:function(){return[]}}},watch:{data:{handler:function(e,t){e[1].length>0&&this.myChartLine()},deep:!0}},mounted:function(){this.data[1].length>0&&this.myChartLine()},methods:{toFixed:function(e){return isNaN(e/1)?e:(e%1!=0&&(e=(e=Number(e)).toFixed(2)),Number(e)===parseInt(e)&&e.toString().indexOf(".")>0?parseInt(e):e)},myChartLine:function(){var e=this,t=x.a.init(document.getElementById("echarsPie"));if(this.data[0].length<2)return!1;var a=this.data[3].matrixTableSource.dictionary.additionalInfoMap.reportConfig||"",r="",i="";a&&(i=a.pie.x,r=a.pie.y);var n=this.data[0].filter(function(e){return e.name===i}),o=[];this.data[1].forEach(function(e){o.push(e[n[0].key])});var s=[],l="";this.data[0].forEach(function(e){e.name===r&&(l=e)}),o.forEach(function(t,a){s.push({value:e.toFixed(e.data[1][a][l.key]),name:t})});var c={title:{text:this.data[2]},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},toolbox:{right:"4%",feature:{saveAsImage:{}}},legend:{orient:"vertical",left:"left",top:"10%",data:o},color:["#028090","#FCBF49","#02C39A","#FFE16D","#80E6B3","#F77F00","#F0F3BD","#D62828","#05668D","#003049"],series:[{name:name,type:"pie",radius:"55%",center:["50%","60%"],data:s,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};t.setOption(c),setTimeout(function(){t.resize()},50)}}},_=(a("Lv1Y"),Object(w.a)(q,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"pieMatrix"},[t("div",{directives:[{name:"show",rawName:"v-show",value:this.data[1].length>0,expression:"data[1].length > 0"}],style:{width:"100%",height:"500px"},attrs:{id:"echarsPie"}})])},[],!1,null,"31ebd1b6",null));_.options.__file="pie.vue";var T=_.exports,C={name:"KlineMatrix",props:{data:{type:Array,default:function(){return[]}}},watch:{data:{handler:function(e,t){e[1].length>0&&this.myChartLine()},deep:!0}},mounted:function(){this.data[1].length>0&&this.myChartLine()},methods:{splcieName:function(e){if(e&&1!==e.length){var t=Number(e.substr(e.length-1));if(isNaN(t))return e;var a=e.substr(0,e.length-1);return this.splcieName(a)}return e},myChartLine:function(){if(this.data[0].length<5)return!1;if(!this.data[3].matrixTableSource)return!1;var e="",t="",a=this.data[3].matrixTableSource.dictionary.additionalInfoMap.reportConfig||"";a?(e=a.kLine.x,t=a.kLine.y):(e=this.data[0][0].key,t=[this.data[0][1].key,this.data[0][2].key,this.data[0][3].key,this.data[0][4].key]);var r=[],i=this.data[0].filter(function(t){return t.name===e});this.data[1].forEach(function(e){r.push(e[i[0].key])});var n=[],o=[];this.data[0].forEach(function(e){t.indexOf(e.name)>-1&&o.push(e)}),this.data[1].forEach(function(e){var t=[];o.forEach(function(a){t.push(e[a.key])}),n.push(t)}),a.kLine.sort&&(r.reverse(),n.reverse());var s=a.kLine.warningRow[0],l=s?this.data[0].filter(function(e){return e.name===s})[0]:"",c=[];s&&this.data[1].forEach(function(e){c.push(e[l.name])});var p=x.a.init(document.getElementById("echarsLineK")),u={title:{text:this.data[2]},tooltip:{trigger:"axis",formatter:function(e){var t=e[0].seriesName+" "+e[0].name;return t+="<br/>  开盘 : "+e[0].value[0]+"  最高 : "+e[0].value[3],t+="<br/>  收盘 : "+e[0].value[1]+"  最低 : "+e[0].value[2],e.length>1&&(t+="<br/> "+e[1].seriesName+"(异动列) : "+e[1].value),t}},legend:{data:[this.splcieName(e),this.splcieName(l.name)]},toolbox:{show:!0,feature:{saveAsImage:{show:!0}}},dataZoom:{show:!0,realtime:!0,start:50,end:100},xAxis:[{type:"category",boundaryGap:!0,axisTick:{onGap:!1},splitLine:{show:!1},data:r}],yAxis:[{type:"value",scale:!0,boundaryGap:[.01,.01]}],series:[{name:"上证指数",type:"k",data:n},{name:this.splcieName(l.name)||"",type:"scatter",data:c,smooth:!0,lineStyle:{normal:{opacity:.5}},itemStyle:{normal:{shadowBlur:10,shadowColor:"rgba(25, 100, 150, 0.5)",shadowOffsetY:5,color:new x.a.graphic.RadialGradient(.4,.3,1,[{offset:0,color:"rgb(129, 227, 238)"},{offset:1,color:"rgb(25, 183, 207)"}])}}}]};p.setOption(u),setTimeout(function(){p.resize()},50)}}},L=(a("O53Z"),Object(w.a)(C,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"KlineMatrix"},[t("div",{directives:[{name:"show",rawName:"v-show",value:this.data[1].length>0,expression:"data[1].length > 0"}],style:{width:"100%",height:"500px"},attrs:{id:"echarsLineK"}})])},[],!1,null,"20328636",null));L.options.__file="KLine.vue";var S=L.exports,k={name:"ScatterMatrix",props:{data:{type:Array,default:function(){return[]}}},data:function(){return{count:0}},watch:{data:{handler:function(e,t){e[1].length>0&&this.myChartScatter()},deep:!0}},mounted:function(){this.data[1].length>0&&this.myChartScatter()},methods:{splcieName:function(e){if(e&&1!==e.length){var t=Number(e.substr(e.length-1));if(isNaN(t))return e;var a=e.substr(0,e.length-1);return this.splcieName(a)}return e},toFixed:function(e){return isNaN(e/1)?e:(e%1!=0&&(e=(e=Number(e)).toFixed(2)),Number(e)===parseInt(e)&&e.toString().indexOf(".")>0?parseInt(e):e)},myChartScatter:function(){var e=this;if(this.data[0].length<2)return!1;if(!this.data[3].matrixTableSource)return!1;var t=x.a.init(document.getElementById("echarsScatter")),a=this.data[3].matrixTableSource.dictionary.additionalInfoMap.reportConfig||"",r="",i="";a?(i=a.scatter.x,r=a.scatter.y):(i=this.data[0][0].key,r=this.data[0][1].key);var n=this.data[0].filter(function(e){return e.name===i}),o=this.data[0].filter(function(e){return e.name===r}),s=[];this.data[1].forEach(function(t){s.push([t[n[0].key],e.toFixed(t[o[0].key])])});var l=0;s.forEach(function(e,t){l+=Number(e[1])}),this.count=0;var c={title:{text:this.data[2]},grid:{left:"3%",right:"7%",bottom:"3%",containLabel:!0},toolbox:{right:"4%",feature:{dataZoom:{},brush:{type:["rect","clear"]},saveAsImage:{}}},brush:{},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(t){var a=e.splcieName(n[0].name)+" : "+t[0].value[0];return a+="<br/>  "+e.splcieName(o[0].name)+" : "+t[0].value[1],e.count&&(a+="<br/>  占比 : "+(e.count/l*100).toFixed(2)+"%"),a}},xAxis:{type:"value",splitLine:{lineStyle:{type:"dashed"}},splitNumber:20},yAxis:{type:"value",splitLine:{lineStyle:{type:"dashed"}}},series:[{symbolSize:20,data:s,type:"scatter",itemStyle:{normal:{shadowBlur:10,shadowColor:"rgba(25, 100, 150, 0.5)",shadowOffsetY:5,color:new x.a.graphic.RadialGradient(.4,.3,1,[{offset:0,color:"rgb(129, 227, 238)"},{offset:1,color:"rgb(25, 183, 207)"}])}}}]};t.on("brushselected",function(e){var t=e.batch[0].selected[0].dataIndex,a=0;s.forEach(function(e,r){t.indexOf(r)>-1&&(a+=Number(e[1]))}),p.count=a});var p=this;t.setOption(c),setTimeout(function(){t.resize()},50)}}},N=(a("ca/E"),Object(w.a)(k,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"scatterMatrix",attrs:{id:"scatterMatrix"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:this.data[1].length>0,expression:"data[1].length > 0"}],style:{width:"100%",height:"500px"},attrs:{id:"echarsScatter"}})])},[],!1,null,"171ffe80",null));N.options.__file="scatter.vue";var E=N.exports;a("xzEC");var O={name:"MapBaidu",props:{data:{type:Array,default:function(){return[]}}},data:function(){return{districtLoading:0,blist:[],bmap:null,dataList:[],geoCoordMap:{},style:{width:"100%",height:"500px"},bigViewShow:!1}},watch:{data:{handler:function(e,t){e[1].length>0&&this.drawChinaCharts()},deep:!0}},mounted:function(){this.data[1].length>0&&this.drawChinaCharts()},methods:{bigView:function(){this.bigViewShow=!this.bigViewShow,this.bigViewShow?this.style={width:"100%",height:"100%"}:this.style={width:"100%",height:"500px"}},convertData:function(e){for(var t=[],a=0;a<e.length;a++){var r=this.geoCoordMap[e[a].name];r&&t.push({name:e[a].name,value:r.concat(e[a].value)})}return t},drawChinaCharts:function(){var e=this,t=this.data[1],a=(this.data[3].matrixTableSource.dictionary.additionalInfoMap.reportConfig||"").map||"";a&&t.forEach(function(t){e.$set(e.geoCoordMap,t[a.name],[t[a.longitude],t[a.latitude]]),e.dataList.push({name:t[a.name],value:t[a.value]})}),console.log(a);var r=a.type.toString(),i=x.a.init(document.getElementById("world-view")),n={title:{text:this.data[2],left:"center"},tooltip:{trigger:"item",axisPointer:{type:"shadow",label:{show:!0,backgroundColor:"rgb(62,157,253)"}},backgroundColor:"rgba(255,255,255,0.8)",textStyle:{color:"#666",fontFamily:"Microsoft YaHei"},borderWidth:1,borderColor:"#888"},visualMap:{right:"2%",min:0,max:500,splitNumber:5,inRange:{color:["#d94e5d","#eac736","#50a3ba"].reverse()},textStyle:{color:"#fff"}},bmap:{center:[104.114129,37.550339],zoom:5,roam:!0,mapStyle:{styleJson:[{featureType:"water",elementType:"all",stylers:{color:"#031628"}},{featureType:"land",elementType:"geometry",stylers:{color:"#000102"}},{featureType:"highway",elementType:"all",stylers:{visibility:"off"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#0b3d51"}},{featureType:"local",elementType:"geometry",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.stroke",stylers:{color:"#08304b"}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-70}},{featureType:"building",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#857f7f"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#000000"}},{featureType:"building",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"green",elementType:"geometry",stylers:{color:"#062032"}},{featureType:"boundary",elementType:"all",stylers:{color:"#465b6c"}},{featureType:"manmade",elementType:"all",stylers:{color:"#022338"}},{featureType:"label",elementType:"all",stylers:{visibility:"on"}}]}},series:[{name:"0"===r?"light":"AQI",type:"0"===r?"scatter":"heatmap",coordinateSystem:"bmap",data:this.convertData(this.dataList.sort(function(e,t){return t.value-e.value})),pointSize:5,blurSize:6,zlevel:1}]};i.setOption(n),this.bmap=i.getModel().getComponent("bmap").getBMap();var o=new window.BMap.Geocoder;this.bmap.addControl(new window.BMap.NavigationControl),this.bmap.addEventListener("click",function(t){o.getLocation(new window.BMap.Point(t.point.lng,t.point.lat),function(a){a&&(e.addDistrict(a.addressComponents.province),console.log("点击了地图为："+a.address+", "+t.point.lng+", "+t.point.lat))})}),window.addEventListener("resize",function(){i.resize()})},addDistrict:function(e){var t=this;this.blist=[],this.districtLoading++,(new window.BMap.Boundary).get(e,function(a){for(var r=a.boundaries.length,i=0;i<r;i++)t.blist.push({points:a.boundaries[i],name:e});t.districtLoading--,0===t.districtLoading&&t.drawBoundary()})},drawBoundary:function(){for(var e=[],t=0;t<this.blist.length;t++){var a=new window.BMap.Polygon(this.blist[t].points,{strokeWeight:1,trokeColor:"#014F99",fillColor:" #DDE4F0"});a.name=this.blist[t].name,this.bmap.clearOverlays(a),this.bmap.addOverlay(a);var r=a.getPath();e=e.concat(r)}this.bmap.setViewport(e)}}},I=(a("++iw"),Object(w.a)(O,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"big-view-data"},[t("div",{class:this.bigViewShow?"bigView":""},[t("div",{on:{click:this.bigView}},[t("svg-icon",{staticClass:"big",attrs:{"icon-class":"big"}})],1),this._v(" "),t("div",{style:this.style,attrs:{id:"world-view"}})])])},[],!1,null,"562dd226",null));I.options.__file="map.vue";var R=I.exports,F=a("6BoF"),B=a.n(F),$={name:"PublicTable",components:{lineMatrix:P,pieMatrix:T,KLineMatrix:S,scatterMatrix:E,mapBaidu:R},props:{matrixId:{type:Number,default:-1},matrixDev:{type:Boolean,default:!1},dev:{type:Boolean,default:!1},ruleParam:{type:Boolean,default:!1},returnFun:{type:Function,default:function(){}},showData:{type:Array,default:function(){return[]}},optionMap:{type:Object,default:function(){}},devUrl:{type:String,default:""},prodUrl:{type:String,default:""}},data:function(){return{martixList:[],searchIf:[],loading:!0,showEcharts:!0,debugSql:"",reportType:"",errorMsg:"",reportColumns:[],list:[],value1:"",listSave:[],typeTable:[],requestParameterMapSave:{},exportType:"",keyDown:"",reqData:{requestParameterMap:{},pageSize:10,targetPage:1,isPaging:1,edit:0,isMonthly:0,isDebug:1,targetReportName:""}}},created:function(){var e=this,t=this.dev?this.devUrl||"http://106.52.178.166:9999/":this.prodUrl||"http://106.52.178.166:9999/";u.a.set("bashUrl",t),setTimeout(function(){e.getMatrix(e.matrixId)},200),document.onkeydown=function(t){e.keyDown+=t.key,6===e.keyDown.length&&("lexing"===e.keyDown&&(e.exportType=0),e.keyDown="")}},methods:{reset:function(){this.reqData.requestParameterMap=JSON.parse(l()(this.requestParameterMapSave)),this.getData(1)},createPicture:function(){var e=this;B()(document.getElementById("tableMatrix"),{backgroundColor:null}).then(function(t){var a=t.toDataURL("image/jpeg");e.fileDownload(a)})},fileDownload:function(e){var t=document.createElement("a");t.style.display="none",t.href=e,t.download=this.martixList.matrixChineseName+".png",document.body.appendChild(t),t.click(),document.body.removeChild(t)},handleValchange:function(e,t,a,r){if("options"===r.multipleParamType){this.reqData.requestParameterMap[a]=[];for(var i=0;i<e.length;i++)for(var n=e[i].length-1;n>0;n--)if(e[i][n]){this.reqData.requestParameterMap[a].push(e[i][n]);break}}else if(e[0]instanceof Array){for(var o=0;o<e.length;o++)for(var s=e[o].length-1;s>0;s--)if(e[o][s]){void 0!==this.reqData.requestParameterMap[a+""+(o+1)]&&(this.reqData.requestParameterMap[a+""+(o+1)]=e[o][s]);break}}else for(var l=e.length-1;l>=0;l--)if(e[l]){this.reqData.requestParameterMap[t]=e[l];break}},splcieName:function(e){if(e&&1!==e.length){var t=Number(e.substr(e.length-1));if(isNaN(t))return e;var a=e.substr(0,e.length-1);return this.splcieName(a)}return e},exportsCheck:function(e){var t=this;if(0===e){var a=o()({},a,this.reqData);a.edit="1",a.isPaging="0",a.requestParameterMap.pageSize=9999,a.pageSize=9999,a.targetReportName=this.martixList.matrixName,a.requestParameterMap=l()(a.requestParameterMap),d({optType:"check",matrixId:this.martixList.matrixId,params:l()(a)}).then(function(e){t.loading=!1,200===e.status&&(e.data.data.isApplying?t.$message.warning("申请中请耐心等候"):t.$prompt("请输入导出申请原因","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){var r=e.value,i={optType:"apply",params:l()(a),reportName:t.martixList.matrixName,matrixId:t.martixList.matrixId,applyReason:r};t.exportReview(i)}).catch(function(){t.$message({type:"info",message:"取消申请"})}))})}else this.exports()},exportReview:function(e){var t=this;d(e).then(function(e){t.loading=!1,200===e.status&&(console.log(e.data.code),200===e.data.code?t.$message.success("申请成功"):t.$message.error(e.data.message))})},exports:function(){var e=this,t=o()({},t,this.reqData);t.edit="1",t.isPaging="0",t.requestParameterMap.pageSize=9999,t.pageSize=9999,t.targetReportName=this.martixList.matrixName,t.requestParameterMap=l()(t.requestParameterMap),function(e){var t=u.a.get("bashUrl")+"dmp-api";return Object(c.a)({url:t+"/marvel/ExtractMatrixWithCsv",method:"POST",data:e})}(t).then(function(t){e.loading=!1,200===t.status&&e.$message.success(t.data.data.message)})},changeDate:function(e,t,a){"月份"===a?(this.reqData.requestParameterMap[t.param]=f(0,"",e[0])[0]+" 00:00:00",this.reqData.requestParameterMap[t.children[0].param]=f(0,"",e[1])[1]+" 23:59:59"):"时间"===a?(this.reqData.requestParameterMap[t.param]=e[0],this.reqData.requestParameterMap[t.children[0].param]=e[1]):(this.reqData.requestParameterMap[t.param]=e[0]+" 00:00:00",this.reqData.requestParameterMap[t.children[0].param]=e[1]+" 23:59:59")},getData:function(e){var t=this;this.loading=!0,this.errorMsg="",this.setGetDataParam(e),function(e){var t=u.a.get("bashUrl")+"dmp-api";return Object(c.a)({url:t+"/marvel/ExtractMatrix",method:"POST",data:e})}(this.reqData).then(function(e){(t.loading=!1,200===e.status)&&(t.list=e.data.data.reportDetaiList?e.data.data.reportDetaiList:[],t.debugSql=e.data.data.debugSql,t.errorMsg=e.data.data.errorMsg,t.listSave=JSON.parse(l()(t.list)),t.typeTable.indexOf("汇总")>-1&&t.countPage(t.listSave),t.typeTable.indexOf("平均")>-1&&t.countPage(t.listSave,"平均"),1===t.reqData.isPaging&&(t.totalList=Number(e.data.data.totalRowCount)),t.ruleParam&&t.returnFun(t.reqData),function(e){var t=u.a.get("bashUrl")+"dmp-api";Object(c.a)({url:t+"/marvel/UpdatePersonalDirectionInfo",method:"POST",data:e})}({marvelBIPersonalInfo:i()({},t.martixList.matrixId,{orderHandle:t.typeTable}),specificKey:t.martixList.matrixId}))})},setGetDataParam:function(e){var t=this,a=this.reqData.requestParameterMap;this.searchIf.forEach(function(e){if("multiple"===e.searchType||"options"===e.multipleParamType){var r=e.item.attachments.param.config.multipleCount;e.clearable&&"departmentParamFilter"===e.searchType&&(a[e.param]&&0!==a[e.param].length||(a[e.param]=[],e.list.forEach(function(t){"全部"!==t.name&&(a[e.param].push(t.value),a[e.paramResetFilter]=[[""]],t.second.length>0&&t.second.forEach(function(t){a[e.param].push(t.value)}))})));for(var i=0;i<=r;i++)t.reqData.requestParameterMap[e.param+i]=0===i?t.reqData.requestParameterMap[e.param].length>0?1:0:t.reqData.requestParameterMap[e.param][i-1]?t.reqData.requestParameterMap[e.param][i-1]:""}e.clearable||"departmentParamFilter"!==e.searchType||e.list.length>0&&(a[e.param]||(a[e.paramResetFilter]=[e.list[0].value],a[e.param]=e.list[0].value))}),this.reqData.requestParameterMap.targetPage=e,this.reqData.targetPage=e,this.reqData.targetReportName=this.martixList.matrixName},copyText:function(e){var t=document.getElementById("input");t.value=e,t.select(),document.execCommand("copy"),this.$message.success("复制成功")},countPage:function(e,t){var a=e,r={};if(0===a.length)return!1;for(var i in a.forEach(function(e){for(var t in e)r[t]=0}),a.forEach(function(e,t){for(var a in e)r[a]+=Number(e[a])}),r)isNaN(r[i])?r[i]="--":"平均"===t&&(r[i]=r[i]/this.listSave.length);this.reportColumns.length>0&&(r[this.reportColumns[0].key]="平均"===t?"平均":"总计"),this.list.push(r)},getMatrix:function(e){var t=this;this.loading=!0,function(e,t){var a=u.a.get("bashUrl")+"dmp-api";return Object(c.a)({url:a+"/marvel/SynchronizeMatrix",method:"POST",data:e})}({synchronizingTopLevelMatrixId:e,isSimplified:0}).then(function(a){if(200===a.status){var r=a.data.data.availableMatrixesList;if(t.martixList=r.filter(function(t){return t.matrixId===e}),t.martixList=t.martixList[0]||[],t.exportType=t.martixList.exportType,t.martixList.matrixTableSource){var i=t.martixList.matrixTableSource.dictionary.additionalInfoMap.reportConfig||"";i&&(t.reportType="",t.$nextTick(function(){t.reportType=i.type}))}else t.reportType="";if(function(e){var t=u.a.get("bashUrl")+"dmp-api";return Object(c.a)({url:t+"/marvel/GetPersonalDirectionInfo",method:"POST",data:e})}({specificKey:t.martixList.matrixId}).then(function(e){200===e.status&&(e.data.data.marvelPersonalInfo[t.martixList.matrixId]?t.typeTable=e.data.data.marvelPersonalInfo[t.martixList.matrixId].orderHandle:t.typeTable=[])}),t.loading=!1,t.getSearchIf(),t.getSelectList(),t.ruleParam&&t.showData.length>0)for(var n in t.reqData.requestParameterMap)for(var o in t.showData[0])n===o&&(t.reqData.requestParameterMap[n]=t.showData[0][o]);t.loading=!1}})},getSelectList:function(){var e=this;this.loading=!0;var t=this.martixList.selectItemList;this.reportColumns=[],t.forEach(function(t){var a={name:t.dictionary.comment?t.dictionary.comment:t.dictionary.itemAlias,key:t.dictionary.itemAlias,dictionary:t.dictionary};e.reportColumns.push(a)})},getSearchIf:function(){var e=this;this.loading=!0;var t=this.martixList.filterItems;this.searchIf=[],t.forEach(function(t){var a={searchType:t.filterParamType,searchParamDec:t.filterParamDescription,param:"multiple"===t.filterParamType||"options"===t.attachments.param.config.multipleParamType?""+t.filterParamDescription:t.filterParamDescription+"1",item:t,data:t.attachments[t.filterParamName],list:[],children:[],paramReset:t.filterParamDescription,paramResetFilter:t.filterParamDescription+"paramReset",clearable:!1,dateList:"",multipleParamType:t.attachments.param.config.multipleParamType,timeDefault:t.attachments.param.config.timeDefault?t.attachments.param.config.timeDefault:"1"},r=t.attachments.param.config;if(a.clearable=r.multipleCount>1,"simple"===r.multipleParamType)for(var i=r.multipleCount,n=JSON.parse(l()(a)),o=2;o<=i;o++)n.param=""+t.filterParamDescription+o,a.children.push(n);for(var s in"multiple"!==t.filterParamType&&"ClientPushConfig"!==t.filterParamType||function(e){var t=u.a.get("bashUrl")+"dmp-api";return Object(c.a)({url:t+"/common/UpdateDbConfigData",method:"POST",data:e})}({}).then(function(t){(function(e){return new y.a(function(t,a){var r="http://q13e3tezd.bkt.clouddn.com/release-"+e+".json",i=void 0;window.XMLHttpRequest&&(i=new XMLHttpRequest),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&t(i.responseText)},i.open("GET",r,!0),i.send()})})(t.data.data.versionMD5String+"-"+r.clientPushConfigType).then(function(t){var i=JSON.parse(t),n=[];(i=i.splice(3,i.length)).forEach(function(e){n.push({key:e[r.keyValue],value:e[r.valueValue]})}),a.list=e.arrReduce(n)})}),e.optionMap)if(s===t.filterParamType&&(a.list=e.optionMap[s].departmentCNDto,a.props={value:"value",children:"second",label:"name",multiple:a.clearable,checkStrictly:!0},a.clearable&&a.list.length>0&&"全部"!==a.list[0].name)){a.list.unshift({isLeader:!1,level:-1,name:"全部",second:[],value:""})}e.searchIf.push(a)}),this.loading=!1,this.resetParam()},resetParam:function(){var e=this;this.loading=!0,this.searchIf.forEach(function(t){if("multiple"===t.searchType||"options"===t.multipleParamType?e.$set(e.reqData.requestParameterMap,t.param,[]):(e.$set(e.reqData.requestParameterMap,t.param,""),t.children.length>0&&t.children.forEach(function(t){e.$set(e.reqData.requestParameterMap,t.param,"")})),t.searchParamDec&&("datePicker-date-startTime"===t.searchType||"datePicker-month"===t.searchType||"datePicker-dateTime-startTime"===t.searchType||"departmentParamFilter"===t.searchType)&&(e.$set(e.reqData.requestParameterMap,t.paramReset,[]),e.$set(e.reqData.requestParameterMap,t.paramResetFilter,[]),"datePicker-date-startTime"===t.searchType||"datePicker-dateTime-startTime"===t.searchType)){switch(t.timeDefault){case"1":e.$set(e.reqData.requestParameterMap,t.paramReset,[g(new Date,3),g(new Date,3)]);break;case"2":e.$set(e.reqData.requestParameterMap,t.paramReset,[h(1,3,new Date),h(1,3,new Date)]);break;case"3":e.$set(e.reqData.requestParameterMap,t.paramReset,[h((new Date).getDay()-1,3,new Date),h(0,3,new Date)]);break;case"4":e.$set(e.reqData.requestParameterMap,t.paramReset,[h((new Date).getDate()-1,3,new Date),h(0,3,new Date)])}"datePicker-dateTime-startTime"===t.searchType&&(e.reqData.requestParameterMap[t.paramReset][0]+=" 00:00:00",e.reqData.requestParameterMap[t.paramReset][1]+=" 23:59:59");var a="datePicker-date-startTime"===t.searchType?"日期":"时间";e.changeDate(e.reqData.requestParameterMap[t.paramReset],t,a)}}),this.requestParameterMapSave=JSON.parse(l()(this.reqData.requestParameterMap)),this.loading=!1},arrReduce:function(e){var t={};return e=e.reduce(function(e,a){return!t[a.key]&&(t[a.key]=e.push(a)),e},[])},setDataType:function(e,t,a){"year"===t&&(this.reqData.requestParameterMap[e]=1===a?f(12-(new Date).getMonth()-1)[1]+" 23:59:59":f((new Date).getMonth()-2*(new Date).getMonth())[0]+" 00:00:00")},toFixed:function(e){return isNaN(e/1)?e:(e%1!=0&&(e=(e=Number(e)).toFixed(2)),Number(e)===parseInt(e)&&e.toString().indexOf(".")>0?parseInt(e):e)},handleCurrentChange:function(e){this.reqData.requestParameterMap.targetPage=e,this.reqData.targetPage=e,this.getData(e)},handleSizeChange:function(e){this.reqData.requestParameterMap.pageSize=e,this.reqData.pageSize=e,this.getData(1)},tableRowClassName:function(e){e.row;var t=e.rowIndex,a=this.typeTable.filter(function(e){return"序号"!==e});return t===this.list.length-1&&a.length>0?"warning-row":t===this.list.length-2&&a.length>1?"success-row":""}}},z=(a("LKpn"),Object(w.a)($,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"searchFull"},[a("textarea",{attrs:{id:"input"}}),e._v(" "),!e.ruleParam&&e.matrixDev?a("div",{staticClass:"btnMsg",staticStyle:{"margin-bottom":"20px"}},[a("el-popover",{ref:"debugSql",attrs:{content:e.debugSql,placement:"top-start",title:"debugSql",width:"800",trigger:"click"}},[a("span",{attrs:{slot:"reference"},on:{click:function(t){e.copyText(e.debugSql)}},slot:"reference"},[a("el-tooltip",{attrs:{content:"debugSql",placement:"bottom",effect:"light"}},[a("svg-icon",{staticClass:"iconError",attrs:{"icon-class":"code"}})],1)],1)]),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),e.errorMsg?a("el-popover",{ref:"errorMsg",attrs:{content:e.errorMsg,placement:"top-start",title:"errorMsg",width:"800",trigger:"click"}},[a("span",{attrs:{slot:"reference"},on:{click:function(t){e.copyText(e.errorMsg)}},slot:"reference"},[a("el-tooltip",{attrs:{content:"errorMsg",placement:"bottom",effect:"light"}},[a("svg-icon",{staticClass:"iconError",attrs:{"icon-class":"bug"}})],1)],1)]):e._e()],1):e._e(),e._v(" "),a("el-form",{staticClass:"forms",attrs:{inline:!0}},[e.searchIf.length>0?a("div",e._l(e.searchIf,function(t,r){return a("div",{key:r},["input"===t.searchType?a("el-form-item",{attrs:{label:t.searchParamDec}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.reqData.requestParameterMap[t.param],callback:function(a){e.$set(e.reqData.requestParameterMap,t.param,a)},expression:"reqData.requestParameterMap[item.param]"}}),e._v(" "),e._l(t.children,function(t,r){return a("el-form-item",{key:r},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.reqData.requestParameterMap[t.param],callback:function(a){e.$set(e.reqData.requestParameterMap,t.param,a)},expression:"reqData.requestParameterMap[itemChildren.param]"}})],1)})],2):e._e(),e._v(" "),"select"===t.searchType?a("el-form-item",{attrs:{label:t.searchParamDec}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.reqData.requestParameterMap[t.param],callback:function(a){e.$set(e.reqData.requestParameterMap,t.param,a)},expression:"reqData.requestParameterMap[item.param]"}},[a("el-option",{attrs:{label:"不限",value:""}}),e._v(" "),e._l(t.data,function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.value}})})],2),e._v(" "),e._l(t.children,function(r,i){return a("el-form-item",{key:i},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.reqData.requestParameterMap[r.param],callback:function(t){e.$set(e.reqData.requestParameterMap,r.param,t)},expression:"reqData.requestParameterMap[itemChildren.param]"}},[a("el-option",{attrs:{label:"不限",value:""}}),e._v(" "),e._l(t.data,function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.value}})})],2)],1)})],2):e._e(),e._v(" "),"multiple"===t.searchType?a("el-form-item",{attrs:{label:t.searchParamDec}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.reqData.requestParameterMap[t.param],callback:function(a){e.$set(e.reqData.requestParameterMap,t.param,a)},expression:"reqData.requestParameterMap[item.param]"}},[a("el-option",{attrs:{label:"不限",value:""}}),e._v(" "),e._l(t.list,function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.value}})})],2)],1):e._e(),e._v(" "),"ClientPushConfig"===t.searchType?a("el-form-item",{attrs:{label:t.searchParamDec}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.reqData.requestParameterMap[t.param],callback:function(a){e.$set(e.reqData.requestParameterMap,t.param,a)},expression:"reqData.requestParameterMap[item.param]"}},[a("el-option",{attrs:{label:"不限",value:""}}),e._v(" "),e._l(t.list,function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.value}})})],2),e._v(" "),e._l(t.children,function(r,i){return a("el-form-item",{key:i},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.reqData.requestParameterMap[r.param],callback:function(t){e.$set(e.reqData.requestParameterMap,r.param,t)},expression:"reqData.requestParameterMap[itemChildren.param]"}},[a("el-option",{attrs:{label:"不限",value:""}}),e._v(" "),e._l(t.list,function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.value}})})],2)],1)})],2):e._e(),e._v(" "),"datePicker-date-startTime"===t.searchType||"datePicker-date-endTime"===t.searchType?a("el-form-item",{attrs:{label:t.searchParamDec}},[a("el-date-picker",{staticStyle:{width:"400px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:function(a){e.changeDate(e.reqData.requestParameterMap[t.paramReset],t,"日期")}},model:{value:e.reqData.requestParameterMap[t.paramReset],callback:function(a){e.$set(e.reqData.requestParameterMap,t.paramReset,a)},expression:"reqData.requestParameterMap[item.paramReset]"}})],1):e._e(),e._v(" "),"datePicker-dateTime-startTime"===t.searchType||"datePicker-dateTime-endTime"===t.searchType?a("el-form-item",{attrs:{label:t.searchParamDec}},[a("el-date-picker",{staticStyle:{width:"400px"},attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:function(a){e.changeDate(e.reqData.requestParameterMap[t.paramReset],t,"时间")}},model:{value:e.reqData.requestParameterMap[t.paramReset],callback:function(a){e.$set(e.reqData.requestParameterMap,t.paramReset,a)},expression:"reqData.requestParameterMap[item.paramReset]"}})],1):e._e(),e._v(" "),"datePicker-month"===t.searchType?a("el-form-item",{attrs:{label:t.searchParamDec}},[a("el-date-picker",{staticStyle:{width:"400px"},attrs:{type:"monthrange","range-separator":"至","start-placeholder":"开始月份","end-placeholder":"结束月份"},on:{change:function(a){e.changeDate(e.reqData.requestParameterMap[t.paramReset],t,"月份")}},model:{value:e.reqData.requestParameterMap[t.paramReset],callback:function(a){e.$set(e.reqData.requestParameterMap,t.paramReset,a)},expression:"reqData.requestParameterMap[item.paramReset]"}})],1):e._e(),e._v(" "),"datePicker-year"===t.searchType?a("el-form-item",{attrs:{label:t.searchParamDec}},[a("el-date-picker",{attrs:{placeholder:"请选择年份",type:"year"},on:{change:function(a){e.setDataType(t.param,"year")}},model:{value:e.reqData.requestParameterMap[t.param],callback:function(a){e.$set(e.reqData.requestParameterMap,t.param,a)},expression:"reqData.requestParameterMap[item.param]"}}),e._v(" "),e._l(t.children,function(t,r){return a("el-form-item",{key:r,attrs:{label:"至"}},[a("el-date-picker",{attrs:{placeholder:"请选择年份",type:"year"},on:{change:function(a){e.setDataType(t.param,"year",1)}},model:{value:e.reqData.requestParameterMap[t.param],callback:function(a){e.$set(e.reqData.requestParameterMap,t.param,a)},expression:"reqData.requestParameterMap[itemChildren.param]"}})],1)})],2):e._e(),e._v(" "),"departmentParamFilter"===t.searchType?a("el-form-item",{attrs:{label:t.searchParamDec}},[a("el-cascader",{attrs:{options:t.list,props:t.props,clearable:t.clearable},on:{change:function(a){e.handleValchange(a,t.param,t.searchParamDec,t)}},model:{value:e.reqData.requestParameterMap[t.paramResetFilter],callback:function(a){e.$set(e.reqData.requestParameterMap,t.paramResetFilter,a)},expression:"reqData.requestParameterMap[item.paramResetFilter]"}})],1):e._e()],1)})):e._e(),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){e.getData(1)}}},[e._v(e._s(e.ruleParam?"预览":"查询"))]),e._v(" "),e.searchIf.length>0?a("el-button",{attrs:{size:"medium"},on:{click:e.reset}},[e._v("清空条件")]):e._e(),e._v(" "),e.reportColumns.length>0&&!e.ruleParam&&2!==e.exportType?a("el-button",{attrs:{type:"success",icon:"el-icon-upload2"},on:{click:function(t){e.exportsCheck(e.exportType)}}},[e._v("导出excel")]):e._e()],1)],1),e._v(" "),e.list.length>0&&!e.ruleParam?a("div",{staticStyle:{float:"right",position:"relative",right:"10px"}},[a("el-checkbox-group",{on:{change:function(t){e.getData(1)}},model:{value:e.typeTable,callback:function(t){e.typeTable=t},expression:"typeTable"}},[a("el-checkbox",{attrs:{label:"汇总",name:"type"}}),e._v(" "),a("el-checkbox",{attrs:{label:"平均",name:"type"}}),e._v(" "),a("el-checkbox",{attrs:{label:"序号",name:"type"}}),e._v(" "),e.reportColumns.length>0&&!e.ruleParam?a("i",{staticClass:"el-icon-download downPic",on:{click:e.createPicture}}):e._e()],1)],1):e._e(),e._v(" "),a("div",{staticClass:"tableTemplate",attrs:{id:"pickupSellTable"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{id:"tableMatrix",data:e.list,"row-class-name":e.tableRowClassName,border:""}},[e.typeTable.indexOf("序号")>=0?a("el-table-column",{attrs:{label:"序号",fixed:"",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index<e.list.length-(e.typeTable.length-1)?a("span",[e._v("\n            "+e._s(t.$index+1)+"\n          ")]):e._e()]}}])}):e._e(),e._v(" "),e._l(e.reportColumns,function(t,r){return a("el-table-column",{key:r,attrs:{label:e.splcieName(t.name),fixed:0===r,"show-overflow-tooltip":"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[a("span",[e._v(e._s(r.row[t.key]||0==r.row[t.key]?e.toFixed(r.row[t.key]):""))])]}}])})})],2),e._v(" "),e.list.length>0&&1==e.reqData.isPaging?a("div",{staticStyle:{float:"right",margin:"10px"}},[a("el-pagination",{attrs:{"current-page":e.reqData.targetPage,"page-size":e.reqData.pageSize,total:e.totalList,"page-sizes":[10,20,50,100],layout:"sizes,total, prev, pager, next"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()],1),e._v(" "),e.reportType&&!e.ruleParam&&e.listSave.length>0?a("div",{staticStyle:{"margin-top":"80px","border-top":"1px solid #ccc"}},[0==e.reportType?a("line-matrix",{attrs:{data:[e.reportColumns,e.listSave,e.martixList.matrixChineseName,e.martixList]}}):e._e(),e._v(" "),1==e.reportType?a("pie-matrix",{attrs:{data:[e.reportColumns,e.listSave,e.martixList.matrixChineseName,e.martixList]}}):e._e(),e._v(" "),2==e.reportType?a("KLine-matrix",{attrs:{data:[e.reportColumns,e.listSave,e.martixList.matrixChineseName,e.martixList]}}):e._e(),e._v(" "),3==e.reportType?a("scatter-matrix",{attrs:{data:[e.reportColumns,e.listSave,e.martixList.matrixChineseName,e.martixList]}}):e._e(),e._v(" "),4==e.reportType?a("mapBaidu",{attrs:{data:[e.reportColumns,e.listSave,e.martixList.matrixChineseName,e.martixList]}}):e._e()],1):e._e()],1)},[],!1,null,null,null));z.options.__file="search.vue";var U=z.exports,A=a("cLjf"),V=a.n(A),j=a("hDQ3"),Z=a.n(j),G=a("unDg"),J=a.n(G);function H(e){var t=u.a.get("bashUrl")+"dmp-api";return Object(c.a)({url:t+"/common/UpdateDbConfigData",method:"POST",data:e})}var Y={name:"MenuItem",props:{data:{type:Array,default:function(){return[]}},returnData:{type:Function,default:function(){}},directionLocation:{type:String,default:function(){}}},data:function(){return{}},mounted:function(){},methods:{getReport:function(e,t,a){var r=[];this.directionLocation?(r=[this.directionLocation],a.forEach(function(e){r.push(e)})):r=a,this.returnData(e,t,r)}}},K=Object(w.a)(Y,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(e.data,function(t,r){return a("el-submenu",{key:r+"1",attrs:{index:t.directionLocation}},[a("template",{slot:"title"},[a("div",[a("i",{staticClass:"el-icon-folder-opened"}),e._v(" "),a("span",{staticStyle:{"margin-left":"15px"}},[e._v(e._s(t.name))])])]),e._v(" "),t.children.length>0?a("menu-item",{attrs:{data:t.children,"direction-location":t.directionLocation,"return-data":e.getReport}}):e._e(),e._v(" "),e._l(t.data,function(r,i){return r.matrixChineseName?a("el-menu-item",{key:i,attrs:{index:r.matrixChineseName},on:{click:function(a){e.getReport(r,0,[t.directionLocation])}}},[e._v(e._s(r.matrixChineseName))]):e._e()})],2)}))},[],!1,null,null,null);K.options.__file="item.vue";var W={components:{Item:K.exports},props:{returnData:{type:Function,default:function(e){}},shows:{type:Boolean,default:!0},dev:{type:Boolean,default:!1},devUrl:{type:String,default:""},prodUrl:{type:String,default:""}},data:function(){return{matrixList:[],show:!1,tableData:null,matrixListMenuShow:!0,matrixType:"",openData:["1"],firstFile:!1,fileList:[],firstFileChild:!1,firstFileChild2:!1,search:"",restaurants:[],matrixDictionaryConfigList:[]}},watch:{dataSource:{handler:function(e,t){this.publicTableReport()},deep:!0}},created:function(){var e=this;u.a.set("bashUrl","");var t=this.dev?this.devUrl||"http://106.52.178.166:9999/":this.prodUrl||"http://106.52.178.166:9999/";u.a.set("bashUrl",t),setTimeout(function(){e.publicTableReport()},100)},methods:{getRooter:function(e,t){var a=!1;return t.forEach(function(t){t.matrixId===e.matrixId&&(a=!0)}),a},handleSelect:function(e){if(this.search=e.matrixChineseName,e.directionName.length>=2){var t=e.directionName[0].split(":");t=t.map(function(e){return e}),this.openData=["1"].concat(J()(t),[e.matrixChineseName])}else this.openData=["1",e.matrixChineseName];this.returnData(e,0,this.matrixListFull)},querySearch:function(e,t){var a=this.restaurants;t(e?a.filter(this.createFilter(e)):a)},createFilter:function(e){return function(t){return 0===t.matrixChineseName.toLowerCase().indexOf(e.toLowerCase())}},getChildrenObj:function(e,t,a,r,i){if(!(e>2)||a[e-2]===t.directionLocation&&a[e-3]===i){for(var n="",o=0;o<e;o++)n+=a[o]+":";n=n.substr(0,n.length-1);var s={name:a[e-1],data:[],directionLocation:a[e-1],key:n,children:[]};r.forEach(function(e){s.key===e.directionLocation&&(s.name=e.directionName)}),t.children.push(s)}return t},publicTableReport:function(){var e=this;return Z()(V.a.mark(function t(){var a;return V.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={specificConfigNameList:["MatrixDictionaryConfig"]},e.loading=!0,t.next=4,H(a).then(function(t){if(e.loading=!1,200===t.status){e.fileList=[];var a=t.data.data.specifigConfigMap.MatrixDictionaryConfig;e.matrixDictionaryConfigList=a,e.matrixDictionaryConfigList.sort(function(e,t){return e.directionLocation.split(":").length>t.directionLocation.split(":").length?1:-1}),e.matrixDictionaryConfigList.forEach(function(t){var a=t.directionLocation.split(":");if(1===a.length){var r={name:t.directionName,directionLocation:a[0],data:[],key:a[0],children:[]};e.fileList.push(r)}}),e.matrixDictionaryConfigList.forEach(function(t){var r=t.directionLocation.split(":");e.fileList.forEach(function(t,i){if(2===r.length&&r[0]===t.directionLocation){var n=e.getChildrenObj(2,t,r,a);t=JSON.parse(l()(n))}})}),e.matrixDictionaryConfigList.forEach(function(t){var r=t.directionLocation.split(":");e.fileList.forEach(function(t,i){3===r.length&&t.children.forEach(function(i){var n=e.getChildrenObj(3,i,r,a,t.directionLocation);i=JSON.parse(l()(n))})})}),e.matrixDictionaryConfigList.forEach(function(t){var r=t.directionLocation.split(":");e.fileList.forEach(function(t,i){4===r.length&&t.children.forEach(function(t){t.children.forEach(function(i){var n=e.getChildrenObj(4,i,r,a,t.directionLocation);i=JSON.parse(l()(n))})})})}),e.matrixDictionaryConfigList.forEach(function(t){var r=t.directionLocation.split(":");e.fileList.forEach(function(t,i){5===r.length&&t.children.forEach(function(t){t.children.forEach(function(t){t.children.forEach(function(i){var n=e.getChildrenObj(5,i,r,a,t.directionLocation);i=JSON.parse(l()(n))})})})})})}});case 4:return t.next=6,e.getMatrixList().then(function(e){return e});case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,e)}))()},add:function(){this.returnData(null,0,"",this.matrixListFull)},getMatrixList:function(){var e=this;return Z()(V.a.mark(function t(){var a;return V.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={isSimplified:1,isPermittedFlag:1},t.next=3,m(a,1).then(function(t){if(200===t.status){e.matrixListMenuShow=!1,e.matrixListFull=t.data.data,e.matrixList=t.data.data.availableMatrixesList,e.fileList.forEach(function(t){t.data=[],e.matrixList.forEach(function(a){if(a.directionName&&a.directionName[0]===t.key)t.data.push(a);else{var r=e.appenChildren(t,a.directionName,a);r&&(a=JSON.parse(l()(r)))}})});var a=[];e.matrixDictionaryConfigList.forEach(function(e){1===e.isShowInDeployBroad&&a.push(e.directionLocation)}),e.restaurants=[],e.matrixList.forEach(function(t){a.indexOf(t.directionName[0])>=0&&e.restaurants.push(t)})}else e.$message.error(t.data.message||"查询失败")});case 3:return t.next=5,e.matrixListFull;case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t,e)}))()},appenChildren:function(e,t,a){var r=this;if(e.children.length>0)return e.children.forEach(function(e){t&&t[0]===e.key?e.data.push(a):r.appenChildren(e,t,a)}),e},getReport:function(e,t,a){console.log(e,t,a),this.returnData(e,t,a,this.matrixListFull),this.openData=["1"].concat(J()(a))}}},Q=(a("ZaiN"),Object(w.a)(W,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"matrixMenu"},[a("el-menu",{directives:[{name:"loading",rawName:"v-loading",value:e.matrixListMenuShow,expression:"matrixListMenuShow"}],staticClass:"el-menu-vertical-demo",attrs:{"default-openeds":e.openData,"default-active":e.search}},[a("el-submenu",{attrs:{index:"1"}},[a("template",{slot:"title"},[a("div",{on:{contextmenu:function(t){return t.preventDefault(),e.clickRight(t)}}},[a("i",{staticClass:"el-icon-document"}),e._v(" "),a("span",[e._v("Matrix列表")])])]),e._v(" "),a("el-menu-item",{attrs:{index:"输入框"}},[a("template",{slot:"title"},[a("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":e.querySearch,clearable:"",placeholder:"请输入我的matrix名称搜索"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.item;return[a("div",{staticClass:"name"},[e._v(e._s(r.matrixChineseName))])]}}]),model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],2),e._v(" "),a("Item",{attrs:{data:e.fileList,"return-data":e.getReport}})],2)],1)],1)},[],!1,null,"31ed67b8",null));Q.options.__file="matrixMenu.vue";var X={components:{search:U,matrixMenu:Q.exports},props:{dev:{type:Boolean,default:!0},devUrl:{type:String,default:""},prodUrl:{type:String,default:""}},data:function(){return{matrixList:[],show:!1,tableData:null,matrixType:"",showMenu:!0,tabs:"",optionMap:{}}},created:function(){u.a.set("bashUrl","");var e=this.dev?this.devUrl||"http://106.52.178.166:9999/":this.prodUrl||"http://106.52.178.166:9999/";u.a.set("bashUrl",e)},methods:{getReport:function(e,t,a,r){var i=this;this.optionMap=r.optionMap,this.show=!1,this.tableData=e?[e]:null,r&&(this.matrixList=r),this.matrixType=t,this.openData=["1",a],this.$nextTick(function(){return i.show=!0})}}},ee=(a("hVY1"),Object(w.a)(X,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"matrixView"},[a("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"leftBox"},[a("matrixMenu",{ref:"matrixMenu",attrs:{"dev-url":e.devUrl,"prod-url":e.prodUrl,dev:e.dev,"data-source":e.tableData,"return-data":e.getReport}})],1),e._v(" "),a("div",{staticClass:"rightBox"},[a("search",{ref:"search",attrs:{"dev-url":e.devUrl,"prod-url":e.prodUrl,"option-map":e.optionMap,dev:e.dev,"matrix-id":16}})],1)])},[],!1,null,"5500db28",null));ee.options.__file="matrixView.vue";t.default=ee.exports},v9CF:function(e,t,a){"use strict";a.r(t);var r=a("EPZ6"),i=a.n(r),n=a("omC7"),o=a.n(n),s=a("2EsI").extendComponentView({type:"bmap",render:function(e,t,a){var r=!0,n=e.getBMap(),s=a.getZr().painter.getViewportRoot(),l=e.coordinateSystem,c=function(t,i){if(!r){var n=s.parentNode.parentNode.parentNode,o=[-parseInt(n.style.left,10)||0,-parseInt(n.style.top,10)||0];s.style.left=o[0]+"px",s.style.top=o[1]+"px",l.setMapOffset(o),e.__mapOffset=o,a.dispatchAction({type:"bmapRoam"})}};function p(){r||a.dispatchAction({type:"bmapRoam"})}n.removeEventListener("moving",this._oldMoveHandler),n.removeEventListener("zoomend",this._oldZoomEndHandler),n.addEventListener("moving",c),n.addEventListener("zoomend",p),this._oldMoveHandler=c,this._oldZoomEndHandler=p;var u=e.get("roam");u&&"scale"!==u?n.enableDragging():n.disableDragging(),u&&"move"!==u?(n.enableScrollWheelZoom(),n.enableDoubleClickZoom(),n.enablePinchToZoom()):(n.disableScrollWheelZoom(),n.disableDoubleClickZoom(),n.disablePinchToZoom());var m=e.__mapStyle,d=e.get("mapStyle")||{},h=o()(d);o()(m)!==h&&(i()(d).length&&n.setMapStyle(d),e.__mapStyle=JSON.parse(h));var f=e.__mapStyle2,g=e.get("mapStyleV2")||{},v=o()(g);o()(f)!==v&&(i()(g).length&&n.setMapStyleV2(g),e.__mapStyle2=JSON.parse(v)),r=!1}});t.default=s},wAwI:function(e,t,a){},xzEC:function(e,t,a){var r=a("2EsI"),i=a("U0Bm");a("YGUQ"),a("v9CF"),r.registerCoordinateSystem("bmap",i),r.registerAction({type:"bmapRoam",event:"bmapRoam",update:"updateLayout"},function(e,t){t.eachComponent("bmap",function(e){var t=e.getBMap(),a=t.getCenter();e.setCenterAndZoom([a.lng,a.lat],t.getZoom())})});t.exports="1.0.0"}}]);